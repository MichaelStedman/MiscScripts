#!/bin/sh
projectName=$1
mkdir $projectName
mkdir $projectName/bin
mkdir $projectName/src
mkdir $projectName/src/include
mkdir $projectName/tests
mkdir $projectName/tests/include
################################################################################
echo Create the makefile
cd $projectName
echo  "CC=gcc" > makefile
echo  "test:" >> makefile
echo  "\t@\$(CC) -g -lrt -lm -o bin/test$projectName tests/test$projectName.c src/library.c -I." >> makefile
echo  "\t@bin/test$projectName" >> makefile
echo  "build:" >> makefile
echo  "\t@\$(CC) -g -lrt -lm -o bin/$projectName src/$projectName.c src/library.c -I." >> makefile
echo  "all:" >> makefile
echo  "\t@\$(CC) -g -lrt -lm -o bin/$projectName src/$projectName.c src/library.c -I." >> makefile
echo  "\t@\$(CC) -g -lrt -lm -o bin/test$projectName tests/test$projectName.c src/library.c -I." >> makefile
echo  "cov:" >> makefile		
echo  "\t@\$(CC) -g -lrt -lm -Wall -fprofile-arcs -ftest-coverage -o bin/test$projectName tests/test$projectName.c src/library.c -I." >> makefile
echo  "\tlcov --directory . --zerocounters" >> makefile
echo  "\t@bin/test$projectName" >> makefile
echo  "\tgcov test$projectName" >> makefile
echo  "\tgcov library" >> makefile
echo  "\tlcov --directory . --capture --output-file coverage/app.info" >> makefile
echo  "\tgenhtml coverage/app.info -o ./coverage" >> makefile
echo  "travistest:" >> makefile
echo  "\t\$(CC) -g -lrt -lm -Wall -fprofile-arcs -ftest-coverage -o test$projectName tests/test$projectName.c src/library.c -I." >> makefile
echo  "\t./test$projectName" >> makefile
echo  "\tgcov test$projectName" >> makefile
echo  "\tgcov library" >> makefile
echo  "travisbuild:" >> makefile
echo  "\t\$(CC) -g -lrt -lm -Wall -fprofile-arcs -ftest-coverage -o $projectName src/$projectName.c src/library.c -I." >> makefile
echo  "\t./$projectName" >> makefile
echo  "\tgcov $projectName" >> makefile

################################################################################
echo Create the main source file
cd src
cat > $projectName.c <<-EOF
/*
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/

#include <stdio.h>
#include "include/library.h"

int main(int argc, char **argv)
{
    printf("Hello World\n");
}
EOF

################################################################################
echo Create the library file
#cd $projectName/src
cat > library.c <<-EOF
/*
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/

#include "include/library.h"
EOF

################################################################################
echo Create the library header file
cd include
cat > library.h <<-EOF
/*
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <ctype.h>
#include <stdbool.h>
#include <assert.h>
#include <stdarg.h>
EOF

################################################################################
echo Create the main test source file
cd ../../tests
cat > test$projectName.c <<- EOF
/*
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/

#include "include/minunit.h"
#include "../src/include/library.h"

void test_setup(void) {
	/* Nothing */
}

void test_teardown(void) {
	/* Nothing */
}

MU_TEST(test_fail) {
	mu_fail("Hello World!");
}

MU_TEST_SUITE(test_suite) {
	MU_SUITE_CONFIGURE(&test_setup, &test_teardown);

	MU_RUN_TEST(test_fail);
}

int main(int argc, char **argv)
{
    MU_RUN_SUITE(test_suite);
    MU_REPORT();
    return 0;    
}
EOF

################################################################################
echo Create minunit unit test header file
cd include
curl https://raw.githubusercontent.com/MichaelStedman/HelloWorldC/master/tests/include/minunit.h > minunit.h

